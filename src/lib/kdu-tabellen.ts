// KdU-Tabellen (Kosten der Unterkunft) - Angemessenheitsgrenzen
// Stand: 2025/2026
// Quelle: Kommunale Satzungen, Jobcenter-Richtlinien

export interface KduGrenze {
  plzRange: string[]
  stadt: string
  jobcenter: string
  // Kaltmiete in EUR nach Personenzahl in BG
  kaltmiete: {
    1: number
    2: number
    3: number
    4: number
    5: number
  }
  // Heizkosten-Richtwert pro qm
  heizkostenProQm: number
  // Qm-Grenzen nach Personenzahl
  qmGrenzen: {
    1: number
    2: number
    3: number
    4: number
    5: number
  }
  gueltigAb: string
  schluessigesKonzept: boolean
  anmerkung?: string
}

export const KDU_TABELLEN: KduGrenze[] = [
  {
    plzRange: ['10115', '10117', '10119', '10178', '10179', '10243', '10245', '10247', '10249', '10315', '10317', '10318', '10319', '10365', '10367', '10369', '10405', '10407', '10409', '10435', '10437', '10439', '10551', '10553', '10555', '10557', '10559', '10585', '10587', '10589', '10623', '10625', '10627', '10629', '10707', '10709', '10711', '10713', '10715', '10717', '10719', '10777', '10779', '10781', '10783', '10785', '10787', '10789', '10823', '10825', '10827', '10829', '10961', '10963', '10965', '10967', '10969', '10997', '10999', '12043', '12045', '12047', '12049', '12051', '12053', '12055', '12057', '12059', '12099', '12101', '12103', '12105', '12107', '12109', '12157', '12159', '12161', '12163', '12165', '12167', '12169', '12203', '12205', '12207', '12209', '12247', '12249', '12277', '12279', '12305', '12307', '12309', '12347', '12349', '12351', '12353', '12355', '12357', '12359', '12435', '12437', '12439', '12459', '12487', '12489', '12524', '12526', '12527', '12555', '12557', '12559', '12587', '12589', '12619', '12621', '12623', '12627', '12629', '13051', '13053', '13055', '13057', '13059', '13086', '13088', '13089', '13125', '13127', '13129', '13156', '13158', '13159', '13187', '13189', '13347', '13349', '13351', '13353', '13355', '13357', '13359', '13403', '13405', '13407', '13409', '13435', '13437', '13439', '13465', '13467', '13469', '13503', '13505', '13507', '13509', '13581', '13583', '13585', '13587', '13589', '13591', '13593', '13595', '13597', '13599', '13627', '13629', '14050', '14052', '14053', '14055', '14057', '14059', '14089', '14109', '14129', '14163', '14165', '14167', '14169', '14193', '14195', '14197', '14199'],
    stadt: 'Berlin',
    jobcenter: 'Jobcenter Berlin',
    kaltmiete: { 1: 426, 2: 515, 3: 634, 4: 713, 5: 857 },
    heizkostenProQm: 1.50,
    qmGrenzen: { 1: 50, 2: 60, 3: 80, 4: 90, 5: 102 },
    gueltigAb: '2024-01-01',
    schluessigesKonzept: true,
    anmerkung: 'AV Wohnen Berlin, inkl. Betriebskosten-Richtwerte',
  },
  {
    plzRange: ['20095', '20097', '20099', '20144', '20146', '20148', '20149', '20249', '20251', '20253', '20255', '20257', '20259', '20354', '20355', '20357', '20359', '20457', '20459', '20535', '20537', '20539', '21029', '21031', '21033', '21035', '21037', '21039', '21073', '21075', '21077', '21079', '21107', '21109', '21129', '21147', '21149', '22041', '22043', '22045', '22047', '22049', '22081', '22083', '22085', '22087', '22089', '22111', '22113', '22115', '22117', '22119', '22143', '22145', '22147', '22149', '22159', '22175', '22177', '22179', '22297', '22299', '22301', '22303', '22305', '22307', '22309', '22335', '22337', '22339', '22359', '22391', '22393', '22395', '22397', '22399', '22415', '22417', '22419', '22453', '22455', '22457', '22459', '22523', '22525', '22527', '22529', '22547', '22549', '22559', '22587', '22589', '22605', '22607', '22609', '22761', '22763', '22765', '22767', '22769'],
    stadt: 'Hamburg',
    jobcenter: 'Jobcenter Hamburg',
    kaltmiete: { 1: 479, 2: 570, 3: 680, 4: 780, 5: 878 },
    heizkostenProQm: 1.55,
    qmGrenzen: { 1: 50, 2: 60, 3: 80, 4: 90, 5: 105 },
    gueltigAb: '2024-01-01',
    schluessigesKonzept: true,
  },
  {
    plzRange: ['80331', '80333', '80335', '80336', '80337', '80339', '80469', '80538', '80539', '80634', '80636', '80637', '80638', '80639', '80686', '80687', '80689', '80796', '80797', '80798', '80799', '80801', '80802', '80803', '80804', '80805', '80807', '80809', '80933', '80935', '80937', '80939', '80992', '80993', '80995', '80997', '80999', '81241', '81243', '81245', '81247', '81249', '81369', '81371', '81373', '81375', '81377', '81379', '81475', '81476', '81477', '81479', '81539', '81541', '81543', '81545', '81547', '81549', '81667', '81669', '81671', '81673', '81675', '81677', '81679', '81735', '81737', '81739', '81825', '81827', '81829', '81925', '81927', '81929'],
    stadt: 'Muenchen',
    jobcenter: 'Jobcenter Muenchen',
    kaltmiete: { 1: 688, 2: 835, 3: 1003, 4: 1158, 5: 1313 },
    heizkostenProQm: 1.45,
    qmGrenzen: { 1: 50, 2: 65, 3: 80, 4: 95, 5: 110 },
    gueltigAb: '2024-01-01',
    schluessigesKonzept: true,
    anmerkung: 'Muenchner Mietspiegel-basiert, sehr hohe Grenzen',
  },
  {
    plzRange: ['50667', '50668', '50670', '50672', '50674', '50676', '50677', '50678', '50679', '50733', '50735', '50737', '50739', '50765', '50767', '50769', '50823', '50825', '50827', '50829', '50858', '50859', '50931', '50933', '50935', '50937', '50939', '50968', '50969', '50996', '50997', '50999', '51061', '51063', '51065', '51067', '51069', '51103', '51105', '51107', '51109'],
    stadt: 'Koeln',
    jobcenter: 'Jobcenter Koeln',
    kaltmiete: { 1: 471, 2: 561, 3: 710, 4: 853, 5: 968 },
    heizkostenProQm: 1.40,
    qmGrenzen: { 1: 50, 2: 65, 3: 80, 4: 95, 5: 110 },
    gueltigAb: '2024-07-01',
    schluessigesKonzept: true,
  },
  {
    plzRange: ['60306', '60308', '60310', '60311', '60313', '60314', '60316', '60318', '60320', '60322', '60323', '60325', '60326', '60327', '60329', '60385', '60386', '60388', '60389', '60431', '60433', '60435', '60437', '60438', '60439', '60486', '60487', '60488', '60489', '60528', '60529', '60549', '60594', '60596', '60598', '60599', '65929', '65931', '65933', '65934', '65936'],
    stadt: 'Frankfurt am Main',
    jobcenter: 'Jobcenter Frankfurt',
    kaltmiete: { 1: 531, 2: 652, 3: 801, 4: 940, 5: 1080 },
    heizkostenProQm: 1.50,
    qmGrenzen: { 1: 50, 2: 60, 3: 80, 4: 90, 5: 105 },
    gueltigAb: '2024-01-01',
    schluessigesKonzept: true,
  },
  {
    plzRange: ['70173', '70174', '70176', '70178', '70180', '70182', '70184', '70186', '70188', '70190', '70191', '70192', '70193', '70195', '70197', '70199', '70327', '70329', '70372', '70374', '70376', '70378', '70435', '70437', '70439', '70469', '70499', '70563', '70565', '70567', '70569', '70597', '70599', '70619', '70629'],
    stadt: 'Stuttgart',
    jobcenter: 'Jobcenter Stuttgart',
    kaltmiete: { 1: 540, 2: 654, 3: 798, 4: 936, 5: 1072 },
    heizkostenProQm: 1.45,
    qmGrenzen: { 1: 45, 2: 60, 3: 75, 4: 90, 5: 105 },
    gueltigAb: '2024-01-01',
    schluessigesKonzept: true,
  },
  {
    plzRange: ['40210', '40211', '40212', '40213', '40215', '40217', '40219', '40221', '40223', '40225', '40227', '40229', '40231', '40233', '40235', '40237', '40239', '40468', '40470', '40472', '40474', '40476', '40477', '40479', '40489', '40545', '40547', '40549', '40589', '40591', '40593', '40595', '40597', '40599', '40625', '40627', '40629'],
    stadt: 'Duesseldorf',
    jobcenter: 'Jobcenter Duesseldorf',
    kaltmiete: { 1: 470, 2: 570, 3: 700, 4: 830, 5: 955 },
    heizkostenProQm: 1.40,
    qmGrenzen: { 1: 50, 2: 65, 3: 80, 4: 95, 5: 110 },
    gueltigAb: '2024-01-01',
    schluessigesKonzept: true,
  },
  {
    plzRange: ['44135', '44137', '44139', '44141', '44143', '44145', '44147', '44149', '44225', '44227', '44229', '44263', '44265', '44267', '44269', '44287', '44289', '44309', '44311', '44319', '44328', '44329', '44339', '44357', '44359', '44369', '44379', '44388'],
    stadt: 'Dortmund',
    jobcenter: 'Jobcenter Dortmund',
    kaltmiete: { 1: 365, 2: 447, 3: 555, 4: 655, 5: 742 },
    heizkostenProQm: 1.35,
    qmGrenzen: { 1: 50, 2: 65, 3: 80, 4: 95, 5: 110 },
    gueltigAb: '2024-01-01',
    schluessigesKonzept: true,
  },
  {
    plzRange: ['45127', '45128', '45130', '45131', '45133', '45134', '45136', '45138', '45139', '45141', '45143', '45144', '45145', '45147', '45149', '45219', '45239', '45257', '45259', '45276', '45277', '45279', '45289', '45307', '45309', '45326', '45327', '45329', '45355', '45356', '45357', '45359'],
    stadt: 'Essen',
    jobcenter: 'Jobcenter Essen',
    kaltmiete: { 1: 358, 2: 443, 3: 538, 4: 623, 5: 717 },
    heizkostenProQm: 1.30,
    qmGrenzen: { 1: 50, 2: 65, 3: 80, 4: 95, 5: 110 },
    gueltigAb: '2024-01-01',
    schluessigesKonzept: true,
  },
  {
    plzRange: ['04103', '04105', '04107', '04109', '04129', '04155', '04157', '04158', '04159', '04177', '04178', '04179', '04205', '04207', '04209', '04229', '04249', '04275', '04277', '04279', '04288', '04289', '04299', '04315', '04316', '04317', '04318', '04319', '04328', '04329', '04347', '04349', '04356', '04357'],
    stadt: 'Leipzig',
    jobcenter: 'Jobcenter Leipzig',
    kaltmiete: { 1: 335, 2: 410, 3: 515, 4: 603, 5: 695 },
    heizkostenProQm: 1.30,
    qmGrenzen: { 1: 45, 2: 60, 3: 75, 4: 90, 5: 105 },
    gueltigAb: '2024-01-01',
    schluessigesKonzept: true,
  },
  {
    plzRange: ['28195', '28197', '28199', '28201', '28203', '28205', '28207', '28209', '28211', '28213', '28215', '28217', '28219', '28237', '28239', '28259', '28277', '28279', '28307', '28309', '28325', '28327', '28329', '28355', '28357', '28359', '28717', '28719', '28755', '28757', '28759', '28777', '28779'],
    stadt: 'Bremen',
    jobcenter: 'Jobcenter Bremen',
    kaltmiete: { 1: 370, 2: 443, 3: 536, 4: 640, 5: 730 },
    heizkostenProQm: 1.35,
    qmGrenzen: { 1: 50, 2: 60, 3: 80, 4: 90, 5: 105 },
    gueltigAb: '2024-01-01',
    schluessigesKonzept: true,
  },
  {
    plzRange: ['01067', '01069', '01097', '01099', '01109', '01127', '01129', '01139', '01157', '01159', '01169', '01187', '01189', '01217', '01219', '01237', '01239', '01257', '01259', '01277', '01279', '01307', '01309', '01324', '01326', '01328', '01445', '01454', '01458', '01465', '01468'],
    stadt: 'Dresden',
    jobcenter: 'Jobcenter Dresden',
    kaltmiete: { 1: 338, 2: 416, 3: 502, 4: 602, 5: 690 },
    heizkostenProQm: 1.30,
    qmGrenzen: { 1: 45, 2: 60, 3: 75, 4: 90, 5: 105 },
    gueltigAb: '2024-01-01',
    schluessigesKonzept: true,
  },
  {
    plzRange: ['30159', '30161', '30163', '30165', '30167', '30169', '30171', '30173', '30175', '30177', '30179', '30419', '30449', '30451', '30453', '30455', '30457', '30459', '30519', '30521', '30539', '30559', '30625', '30627', '30629', '30655', '30657', '30659', '30669'],
    stadt: 'Hannover',
    jobcenter: 'Jobcenter Region Hannover',
    kaltmiete: { 1: 405, 2: 490, 3: 600, 4: 710, 5: 810 },
    heizkostenProQm: 1.35,
    qmGrenzen: { 1: 50, 2: 60, 3: 80, 4: 90, 5: 105 },
    gueltigAb: '2024-01-01',
    schluessigesKonzept: true,
  },
  {
    plzRange: ['90402', '90403', '90408', '90409', '90411', '90419', '90425', '90427', '90429', '90431', '90439', '90441', '90443', '90449', '90451', '90453', '90455', '90459', '90461', '90469', '90471', '90473', '90475', '90478', '90480', '90482', '90489', '90491'],
    stadt: 'Nuernberg',
    jobcenter: 'Jobcenter Nuernberg',
    kaltmiete: { 1: 400, 2: 490, 3: 595, 4: 690, 5: 790 },
    heizkostenProQm: 1.35,
    qmGrenzen: { 1: 50, 2: 65, 3: 80, 4: 95, 5: 110 },
    gueltigAb: '2024-01-01',
    schluessigesKonzept: true,
  },
  {
    plzRange: ['47051', '47053', '47055', '47057', '47058', '47059', '47119', '47137', '47138', '47139', '47166', '47167', '47169', '47178', '47179', '47198', '47199', '47226', '47228', '47229', '47239', '47249', '47259', '47269', '47279'],
    stadt: 'Duisburg',
    jobcenter: 'Jobcenter Duisburg',
    kaltmiete: { 1: 335, 2: 418, 3: 505, 4: 598, 5: 685 },
    heizkostenProQm: 1.30,
    qmGrenzen: { 1: 50, 2: 65, 3: 80, 4: 95, 5: 110 },
    gueltigAb: '2024-01-01',
    schluessigesKonzept: false,
    anmerkung: 'Kein schluessiges Konzept - tatsaechliche Kosten koennen gefordert werden!',
  },
  {
    plzRange: ['44787', '44789', '44791', '44793', '44795', '44797', '44799', '44801', '44803', '44805', '44807', '44809', '44866', '44867', '44869', '44879', '44892', '44894'],
    stadt: 'Bochum',
    jobcenter: 'Jobcenter Bochum',
    kaltmiete: { 1: 345, 2: 430, 3: 520, 4: 610, 5: 700 },
    heizkostenProQm: 1.30,
    qmGrenzen: { 1: 50, 2: 65, 3: 80, 4: 95, 5: 110 },
    gueltigAb: '2024-01-01',
    schluessigesKonzept: true,
  },
  {
    plzRange: ['42103', '42105', '42107', '42109', '42111', '42113', '42115', '42117', '42119', '42275', '42277', '42279', '42281', '42283', '42285', '42287', '42289', '42327', '42329', '42349', '42369', '42379', '42389', '42399'],
    stadt: 'Wuppertal',
    jobcenter: 'Jobcenter Wuppertal',
    kaltmiete: { 1: 335, 2: 405, 3: 490, 4: 575, 5: 660 },
    heizkostenProQm: 1.30,
    qmGrenzen: { 1: 50, 2: 65, 3: 80, 4: 95, 5: 110 },
    gueltigAb: '2024-01-01',
    schluessigesKonzept: false,
    anmerkung: 'Kein schluessiges Konzept vorhanden',
  },
  {
    plzRange: ['33602', '33604', '33605', '33607', '33609', '33611', '33613', '33615', '33617', '33619', '33647', '33649', '33659', '33689', '33699', '33719', '33729', '33739'],
    stadt: 'Bielefeld',
    jobcenter: 'Jobcenter Bielefeld',
    kaltmiete: { 1: 350, 2: 433, 3: 530, 4: 623, 5: 715 },
    heizkostenProQm: 1.30,
    qmGrenzen: { 1: 50, 2: 65, 3: 80, 4: 95, 5: 110 },
    gueltigAb: '2024-01-01',
    schluessigesKonzept: true,
  },
  {
    plzRange: ['53111', '53113', '53115', '53117', '53119', '53121', '53123', '53125', '53127', '53129', '53173', '53175', '53177', '53179', '53225', '53227', '53229'],
    stadt: 'Bonn',
    jobcenter: 'Jobcenter Bonn',
    kaltmiete: { 1: 445, 2: 540, 3: 665, 4: 780, 5: 890 },
    heizkostenProQm: 1.40,
    qmGrenzen: { 1: 50, 2: 60, 3: 80, 4: 90, 5: 105 },
    gueltigAb: '2024-01-01',
    schluessigesKonzept: true,
  },
  {
    plzRange: ['68159', '68161', '68163', '68165', '68167', '68169', '68199', '68219', '68229', '68239', '68259', '68305', '68307', '68309'],
    stadt: 'Mannheim',
    jobcenter: 'Jobcenter Mannheim',
    kaltmiete: { 1: 380, 2: 470, 3: 570, 4: 660, 5: 755 },
    heizkostenProQm: 1.35,
    qmGrenzen: { 1: 45, 2: 60, 3: 75, 4: 90, 5: 105 },
    gueltigAb: '2024-01-01',
    schluessigesKonzept: true,
  },
]

export function findKduByPlz(plz: string): KduGrenze | undefined {
  return KDU_TABELLEN.find(k => k.plzRange.includes(plz))
}

export function findKduByStadt(stadt: string): KduGrenze | undefined {
  const lower = stadt.toLowerCase().replace(/ü/g, 'ue').replace(/ö/g, 'oe').replace(/ä/g, 'ae')
  return KDU_TABELLEN.find(k => k.stadt.toLowerCase() === lower || k.stadt.toLowerCase().includes(lower))
}

export function checkKduAngemessenheit(
  plz: string,
  bgGroesse: number,
  kaltmiete: number
): { angemessen: boolean; grenze: number; differenz: number; stadt: string } | null {
  const kdu = findKduByPlz(plz)
  if (!kdu) return null

  const size = Math.min(bgGroesse, 5) as 1 | 2 | 3 | 4 | 5
  const grenze = kdu.kaltmiete[size]
  const differenz = kaltmiete - grenze

  return {
    angemessen: differenz <= 0,
    grenze,
    differenz: Math.max(0, differenz),
    stadt: kdu.stadt,
  }
}
